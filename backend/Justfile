# Justfile - automatisation Django (Windows + PowerShell)
set shell := ["powershell", "-Command"]

# --- COMMANDES DANS LE CONTENEUR (Rapides) ---

# Lancer le serveur Django
run:
    docker compose exec koobfood /app/.venv/bin/python manage.py runserver 0.0.0.0:8000

# Créer les migrations
makemigrations:
    docker compose exec koobfood /app/.venv/bin/python manage.py makemigrations

# Appliquer les migrations
migrate:
    docker compose exec koobfood /app/.venv/bin/python manage.py migrate

# Créer un superutilisateur
superuser:
    docker compose exec koobfood /app/.venv/bin/python manage.py createsuperuser

# Voir les URLs
urls:
    docker compose exec koobfood /app/.venv/bin/python manage.py show_urls

# Lancer les tests avec coverage
coverage:
    docker compose exec koobfood /app/.venv/bin/python -m coverage run manage.py test

# Afficher le rapport de coverage
report:
    docker compose exec koobfood /app/.venv/bin/python -m coverage report

# --- COMMANDES DE MAINTENANCE DOCKER ---

# Build toutes les images Docker
build-all:
    docker compose up --build -d

# Démarrer les conteneurs Docker
up:
    docker compose up -d

# Stopper les conteneurs Docker
down:
    docker compose down

# Redémarrer un service
restart service:
    docker compose restart {{service}}

# Suivre les logs
logs service:
    docker compose logs -f {{service}}

# --- COMMANDES LOCALES (UV sur Windows pour l'IDE) ---

# Nettoyer les fichiers inutiles
clean:
    Get-ChildItem -Recurse -Include "__pycache__", "*.pyc" | Remove-Item -Recurse -Force

# Ajouter un package (ajoute au pyproject.toml ET réinstalle dans Docker au prochain build)
add package:
    uv add {{package}}